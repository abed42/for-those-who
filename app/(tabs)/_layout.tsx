import AssistantChat from "@/components/AssistantChat";
import ModalScreen from "@/components/modal";
import { Tabs } from "expo-router";
import { useState } from "react";
import "react-native-reanimated";
import Svg, { Path } from "react-native-svg";
import { AssistantModalContext } from "../contexts/AssistantModalContext";
import { AssistantArticleContext } from "../contexts/AssistantArticleContext";
import { ActionType } from "@/constants/ActionType";
import * as SecureStore from "expo-secure-store";
import { router } from "expo-router";
import { TouchableOpacity, View, Platform, ActionSheetIOS } from "react-native";

const SvgComponent = () => {
  return (
    <Svg width="250" height="18" viewBox="0 0 250 18" fill="none">
      <Path
        fill-rule="evenodd"
        clip-rule="evenodd"
        d="M58.3221 5.10089H54.261V17.3332H48.6894V5.10089H44.6533V0H58.3221V5.10089ZM0.000976562 9.27045e-05V17.3338H5.54756V11.7622H11.391V7.27995H5.54756V4.87814H12.109V9.27045e-05H0.000976562ZM21.7954 11.0692C21.7954 9.88097 21.0034 9.03906 19.7648 9.03906C18.5517 9.03906 17.7588 9.88097 17.7588 11.0692C17.7588 12.2583 18.5517 13.1002 19.7648 13.1002C21.0034 13.1002 21.7954 12.2583 21.7954 11.0692ZM26.6982 11.0688C26.6982 14.957 23.7022 17.6556 19.765 17.6556C15.8528 17.6556 12.8564 14.957 12.8564 11.0688C12.8564 7.15655 15.8528 4.48242 19.765 4.48242C23.7022 4.48242 26.6982 7.15655 26.6982 11.0688ZM36.9754 9.6803V4.48047C35.5145 4.48047 34.0535 5.32237 33.2116 6.75838V4.7773H28.3086V17.3319H33.2116V12.8251C33.2116 11.2402 33.2611 9.06124 36.9754 9.6803ZM72.8824 17.3332V9.48334C72.8824 7.65112 72.0405 4.48183 68.2767 4.48183C66.6424 4.48183 65.5531 5.19983 64.8346 6.06625V0H59.9316V17.3332H64.8346V11.0187C64.8346 10.0284 65.3048 9.28545 66.3946 9.28545C67.5088 9.28545 67.9799 10.0284 67.9799 11.0187V17.3332H72.8824ZM83.4321 11.0692C83.4321 9.88097 82.6401 9.03906 81.4011 9.03906C80.1879 9.03906 79.3955 9.88097 79.3955 11.0692C79.3955 12.2583 80.1879 13.1002 81.4011 13.1002C82.6401 13.1002 83.4321 12.2583 83.4321 11.0692ZM88.3353 11.0688C88.3353 14.957 85.3385 17.6556 81.4013 17.6556C77.4895 17.6556 74.4932 14.957 74.4932 11.0688C74.4932 7.15655 77.4895 4.48242 81.4013 4.48242C85.3385 4.48242 88.3353 7.15655 88.3353 11.0688ZM94.7524 17.6537C98.4409 17.6537 100.844 16.2426 100.844 13.3701C100.844 10.9438 98.937 10.077 95.7672 9.40799L95.5855 9.37284L95.5839 9.37255C94.667 9.19605 94.0344 9.07427 94.0344 8.51661C94.0344 8.07093 94.4542 7.7741 95.1482 7.7741C95.7427 7.7741 96.2129 8.04641 96.3863 8.56608L100.224 7.62524C99.704 5.49574 97.2772 4.48047 95.0978 4.48047C91.904 4.48047 89.3293 5.86745 89.3293 8.66503C89.3293 11.2652 91.038 12.0576 93.5138 12.5782C93.7421 12.6273 93.9631 12.6692 94.1719 12.7087C95.1186 12.8881 95.8162 13.0203 95.8162 13.568C95.8162 13.9892 95.396 14.286 94.653 14.286C93.7117 14.286 93.3159 13.7909 93.1916 13.4192L88.958 14.7322C89.5026 16.9611 92.3256 17.6537 94.7524 17.6537ZM110.378 9.85568C110.13 8.79093 109.511 8.17188 108.347 8.17188C107.308 8.17188 106.639 8.81589 106.366 9.85568H110.378ZM114.91 12.2819H106.392C106.739 13.3471 107.556 13.9662 108.892 13.9662C110.13 13.9662 110.899 13.3966 111.221 12.926L114.464 14.8576C113.498 16.3435 111.517 17.6556 108.892 17.6556C104.361 17.6556 101.588 14.8081 101.588 11.0688C101.588 7.28045 104.41 4.48242 108.249 4.48242C112.161 4.48242 115.405 6.98317 114.91 12.2819ZM142.225 17.3337L147.351 0H141.383L139.18 9.21102L136.703 0H132.815L130.34 9.21102L128.16 0H122.168L127.293 17.3337H132.271L134.772 8.09725L137.248 17.3337H142.225ZM161.418 9.48334V17.3332H156.515V11.0187C156.515 10.0284 156.044 9.28545 154.929 9.28545C153.84 9.28545 153.369 10.0284 153.369 11.0187V17.3332H148.467V0H153.369V6.06625C154.088 5.19983 155.177 4.48183 156.811 4.48183C160.576 4.48183 161.418 7.65112 161.418 9.48334ZM169.94 9.03906C171.178 9.03906 171.971 9.88097 171.971 11.0692C171.971 12.2583 171.178 13.1002 169.94 13.1002C168.726 13.1002 167.934 12.2583 167.934 11.0692C167.934 9.88097 168.726 9.03906 169.94 9.03906ZM169.94 17.6556C173.877 17.6556 176.873 14.957 176.873 11.0688C176.873 7.15655 173.877 4.48242 169.94 4.48242C166.028 4.48242 163.031 7.15655 163.031 11.0688C163.031 14.957 166.028 17.6556 169.94 17.6556Z"
        fill="black"
      />
      <Path
        fill-rule="evenodd"
        clip-rule="evenodd"
        d="M249.999 17.6543H186.831V0.855469H192.011V12.4745H244.819V0.855469H249.999V17.6543Z"
        fill="#0029FF"
      />
    </Svg>
  );
};

const FeedSvg = ({ fill }: { fill: string }) => {
  return (
    <Svg width="25" height="21" viewBox="0 0 25 21">
      <Path
        d="M8.125 2.25C7.50156 2.25 7 2.75156 7 3.375V17.625C7 18.0187 6.93437 18.3984 6.80781 18.75H20.875C21.4984 18.75 22 18.2484 22 17.625V3.375C22 2.75156 21.4984 2.25 20.875 2.25H8.125ZM3.625 21C1.75938 21 0.25 19.4906 0.25 17.625V3.75C0.25 3.12656 0.751562 2.625 1.375 2.625C1.99844 2.625 2.5 3.12656 2.5 3.75V17.625C2.5 18.2484 3.00156 18.75 3.625 18.75C4.24844 18.75 4.75 18.2484 4.75 17.625V3.375C4.75 1.50938 6.25938 0 8.125 0H20.875C22.7406 0 24.25 1.50938 24.25 3.375V17.625C24.25 19.4906 22.7406 21 20.875 21H3.625ZM8.5 4.875C8.5 4.25156 9.00156 3.75 9.625 3.75H14.125C14.7484 3.75 15.25 4.25156 15.25 4.875V8.625C15.25 9.24844 14.7484 9.75 14.125 9.75H9.625C9.00156 9.75 8.5 9.24844 8.5 8.625V4.875ZM17.875 3.75H19.375C19.9984 3.75 20.5 4.25156 20.5 4.875C20.5 5.49844 19.9984 6 19.375 6H17.875C17.2516 6 16.75 5.49844 16.75 4.875C16.75 4.25156 17.2516 3.75 17.875 3.75ZM17.875 7.5H19.375C19.9984 7.5 20.5 8.00156 20.5 8.625C20.5 9.24844 19.9984 9.75 19.375 9.75H17.875C17.2516 9.75 16.75 9.24844 16.75 8.625C16.75 8.00156 17.2516 7.5 17.875 7.5ZM9.625 11.25H19.375C19.9984 11.25 20.5 11.7516 20.5 12.375C20.5 12.9984 19.9984 13.5 19.375 13.5H9.625C9.00156 13.5 8.5 12.9984 8.5 12.375C8.5 11.7516 9.00156 11.25 9.625 11.25ZM9.625 15H19.375C19.9984 15 20.5 15.5016 20.5 16.125C20.5 16.7484 19.9984 17.25 19.375 17.25H9.625C9.00156 17.25 8.5 16.7484 8.5 16.125C8.5 15.5016 9.00156 15 9.625 15Z"
        fill={fill}
      />
    </Svg>
  );
};

const AssistantSvg = ({ fill }: { fill: string }) => {
  return (
    <Svg width="25" height="25" viewBox="0 0 25 25">
      <Path
        d="M16.0781 4.53125L18.75 3.5L19.7344 0.875C19.7812 0.640625 20.0156 0.5 20.25 0.5C20.4375 0.5 20.6719 0.640625 20.7188 0.875L21.75 3.5L24.375 4.53125C24.6094 4.57812 24.75 4.8125 24.75 5C24.75 5.23438 24.6094 5.46875 24.375 5.51562L21.75 6.5L20.7188 9.17188C20.6719 9.35938 20.4375 9.5 20.25 9.5C20.0156 9.5 19.7812 9.35938 19.7344 9.17188L18.75 6.5L16.0781 5.51562C15.8906 5.46875 15.75 5.23438 15.75 5C15.75 4.8125 15.8906 4.57812 16.0781 4.53125ZM1.17188 11.75L1.96875 11.4219L2.34375 11.2344H2.39062L6.51562 9.3125L8.4375 5.14062L8.625 4.76562L9 3.96875C9.09375 3.6875 9.375 3.5 9.65625 3.5C9.9375 3.5 10.2188 3.6875 10.3594 3.96875L10.7344 4.76562L10.875 5.14062L10.9219 5.1875L12.7969 9.3125L16.9688 11.2344L17.3438 11.4219L18.1406 11.7969C18.4219 11.8906 18.6094 12.1719 18.6094 12.4531C18.6094 12.7344 18.4219 13.0156 18.1406 13.1562L17.3438 13.4844L16.9688 13.6719L12.7969 15.5938L10.875 19.7188V19.7656L10.6875 20.1406L10.3594 20.9375C10.2188 21.2188 9.9375 21.4062 9.65625 21.4062C9.375 21.4062 9.09375 21.2188 9 20.9375L8.625 20.1406L8.4375 19.7656V19.7188L6.51562 15.5938L2.39062 13.6719H2.34375L1.96875 13.4844L1.17188 13.1562C0.890625 13.0156 0.75 12.7344 0.75 12.4531C0.75 12.1719 0.890625 11.8906 1.17188 11.75ZM5.0625 12.4531L7.45312 13.5781C7.92188 13.7656 8.34375 14.1875 8.57812 14.6562L9.65625 17.0469L10.7812 14.6562C11.0156 14.1875 11.3906 13.7656 11.8594 13.5781L14.25 12.4531L11.8594 11.3281C11.3906 11.1406 11.0156 10.7188 10.7812 10.25L9.65625 7.85938L8.57812 10.25C8.34375 10.7188 7.92188 11.1406 7.45312 11.3281L5.0625 12.4531ZM18.75 18.5L19.7344 15.875C19.7812 15.6406 20.0156 15.5 20.25 15.5C20.4375 15.5 20.6719 15.6406 20.7188 15.875L21.75 18.5L24.375 19.5312C24.6094 19.5781 24.75 19.8125 24.75 20C24.75 20.2344 24.6094 20.4687 24.375 20.5156L21.75 21.5L20.7188 24.1719C20.6719 24.3594 20.4375 24.5 20.25 24.5C20.0156 24.5 19.7812 24.3594 19.7344 24.1719L18.75 21.5L16.0781 20.5156C15.8906 20.4687 15.75 20.2344 15.75 20C15.75 19.8125 15.8906 19.5781 16.0781 19.5312L18.75 18.5Z"
        fill={fill}
      />
    </Svg>
  );
};

const UserSvg = ({ fill }: { fill: string }) => {
  return (
    <Svg width="25" height="21" viewBox="0 0 448 512">
      <Path
        d="M304 128a80 80 0 1 0 -160 0 80 80 0 1 0 160 0zM96 128a128 128 0 1 1 256 0A128 128 0 1 1 96 128zM49.3 464l349.5 0c-8.9-63.3-63.3-112-129-112l-91.4 0c-65.7 0-120.1 48.7-129 112zM0 482.3C0 383.8 79.8 304 178.3 304l91.4 0C368.2 304 448 383.8 448 482.3c0 16.4-13.3 29.7-29.7 29.7L29.7 512C13.3 512 0 498.7 0 482.3z"
        fill={fill}
      />
    </Svg>
  );
};

export default function TabsLayout() {
  const [isModalVisible, setIsModalVisible] = useState<boolean>(false);
  const [threadId, setThreadId] = useState<string>("");
  const [article, setArticle] = useState<any>({});
  const [actionType, setActionType] = useState<ActionType>();

  const onPress = () =>
    ActionSheetIOS.showActionSheetWithOptions(
      {
        options: ["Cancel", "Log out"],
        cancelButtonIndex: 0,
        userInterfaceStyle: "light",
      },
      (buttonIndex) => {
        if (buttonIndex === 1) {
          router.replace("/");
          SecureStore.deleteItemAsync("userId");
          SecureStore.deleteItemAsync("token");
        }
      }
    );

  return (
    <AssistantModalContext.Provider
      value={{ isModalVisible, setIsModalVisible }}
    >
      <AssistantArticleContext.Provider
        value={{
          article,
          setArticle,
          threadId,
          setThreadId,
          actionType,
          setActionType,
        }}
      >
        <Tabs
          screenOptions={{
            tabBarActiveTintColor: "#0029FF",
            tabBarStyle: { height: 92, paddingLeft: 12, paddingRight: 12 },
          }}
        >
          <Tabs.Screen
            name="feed"
            options={{
              title: "Feed",
              tabBarIcon: ({ color }) => <FeedSvg fill={color} />,
              headerTitle: () => <SvgComponent />,
              headerRight: () => (
                <TouchableOpacity onPress={onPress}>
                  {Platform.OS === "ios" && (
                    <View
                      style={{
                        marginRight: 18,
                        padding: 6,
                        borderRadius: 50,
                        borderWidth: 1,
                        display: "flex",
                        alignItems: "center",
                        borderColor: "#F9F7F7",
                      }}
                    >
                      <UserSvg fill="#979BB1" />
                    </View>
                  )}
                </TouchableOpacity>
              ),
            }}
          />
          <Tabs.Screen
            name="assistant"
            options={{
              title: "Assistant",
              tabBarIcon: ({ color }) => <AssistantSvg fill={color} />,
              headerTitle: () => <SvgComponent />,
            }}
          />
        </Tabs>
        <ModalScreen
          isVisible={isModalVisible}
          onClose={() => setIsModalVisible(false)}
        >
          <AssistantChat />
        </ModalScreen>
      </AssistantArticleContext.Provider>
    </AssistantModalContext.Provider>
  );
}
